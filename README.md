# CodeLab AI Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è AI –∞–≥–µ–Ω—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º.

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ —Å–ª–æ–∏—Å—Ç—É—é, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (–ø–∞–ø–∫–∏: api, models, services, middleware, core) c —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Python 3.12+. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–∏–Ω—Ç–∏–Ω–≥ –∏ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

## üéØ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø:** –§–∞–∑–∞ 1 - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –ò—Ç–µ—Ä–∞—Ü–∏—è 1.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–ó–ê–í–ï–†–®–ï–ù–û)
- üèó –ò—Ç–µ—Ä–∞—Ü–∏—è 1.2: –ë–∞–∑–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–í –ü–†–û–¶–ï–°–°–ï)

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å—Ö–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

*–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã –∏ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö LLM, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –æ—á–µ—Ä–µ–¥–µ–π –∏–ª–∏ –≤–µ—Ä—Å–∏–π API –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.*

–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ routes –∏ —Å—Ö–µ–º—ã –æ–±–º–µ–Ω–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏:

| –°–µ—Ä–≤–∏—Å         | REST/SSE endpoint                         | WebSocket endpoint         | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                       |
|----------------|:------------------------------------------|----------------------------|------------------------------------|
| gateway        | /health                                  | /ws/{session_id}           | –ß–µ—Ä–µ–∑ WebSocket –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Å—Ç—Ä–∏–º–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –º–µ–∂–¥—É IDE –∏ agent-runtime |
| agent-runtime  | /health, /agent/message/stream           |                            | –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç SSE –∫ llm-proxy –Ω–∞ /v1/chat/completions, –Ω—É–∂–µ–Ω x-internal-auth |
| llm-proxy      | /health, /v1/llm/models, /v1/chat/completions |                            | SSE, REST endpoint, –≤—Å–µ —Ç—Ä–µ–±—É—é—Ç x-internal-auth |

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º –∏ –≤—Å–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–º REST/WebSocket API** ‚Äî —Å–º. –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π  `README.md` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ ([gateway/README.md](gateway/README.md), [agent-runtime/README.md](agent-runtime/README.md), [llm-proxy/README.md](llm-proxy/README.md)).


### Gateway Service
- WebSocket –ø—Ä–æ–∫—Å–∏ –º–µ–∂–¥—É IDE –∏ Agent
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### Agent Runtime Service
- –û—Å–Ω–æ–≤–Ω–∞—è AI –ª–æ–≥–∏–∫–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### LLM Proxy Service
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI –∏ Anthropic
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –æ—Ç–≤–µ—Ç–æ–≤

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.12+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏–º–µ–Ω–Ω–æ —Å —ç—Ç–æ–π –≤–µ—Ä—Å–∏–µ–π)
- Docker –∏ Docker Compose
- uv (–±—ã—Å—Ç—Ä—ã–π Python package installer)

## üîë –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏

–í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ REST/SSE-–∑–∞–ø—Ä–æ—Å—ã –∑–∞—â–∏—â–µ–Ω—ã –∫–ª—é—á–∞–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
- Gateway: `GATEWAY__INTERNAL_API_KEY`
- Agent Runtime: `AGENT_RUNTIME__INTERNAL_API_KEY`
- LLM Proxy: `LLM_PROXY__INTERNAL_API_KEY`

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ X-Internal-Auth –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ö–ª—é—á–∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ docker-compose –∏–∑ .env —Ñ–∞–π–ª–∞
- –ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoint'—ã –≤–µ—Ä–Ω—É—Ç 401 Unauthorized

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:

```bash
# –ó–∞–ø—Ä–æ—Å –∫ Agent Runtime
curl -X POST http://localhost:8001/agent/message/stream \
    -H "X-Internal-Auth: ${AGENT_RUNTIME__INTERNAL_API_KEY}" \
    -H "Content-Type: application/json" \
    -d '{"session_id": "demo", "type": "user_message", "content": "–ü—Ä–∏–≤–µ—Ç!"}'

# –ó–∞–ø—Ä–æ—Å –∫ LLM Proxy
curl -X POST http://localhost:8002/v1/chat/completions \
    -H "X-Internal-Auth: ${LLM_PROXY__INTERNAL_API_KEY}" \
    -H "Content-Type: application/json" \
    -d '{"model": "gpt-4", "messages": [{"role": "user", "content": "Say hello!"}], "stream": true, "temperature": 1}'
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

<details>
<summary><b>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏ –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ</b></summary>

- <b>app/api/</b> ‚Äî entrypoints FastAPI (REST/WebSocket)
- <b>app/models/</b> ‚Äî Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö API/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- <b>app/services/</b> ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (LLM, –±—É—Ñ–µ—Ä—ã, —Å—Ç–æ—Ä—ã, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
- <b>app/middleware/</b> ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- <b>app/core/</b> ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, DI, –ª–æ–≥–≥–µ—Ä, –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
</details>

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/openidealab/codelab-ai-service.git
cd codelab-ai-service
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ uv:
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example:
```bash
cp .env.example .env
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env —Ñ–∞–π–ª–µ:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–µ—é—Ç —Å–≤–æ–π –ø—Ä–µ—Ñ–∏–∫—Å:
  - `GATEWAY__` –¥–ª—è Gateway —Å–µ—Ä–≤–∏—Å–∞
  - `AGENT_RUNTIME__` –¥–ª—è Agent Runtime —Å–µ—Ä–≤–∏—Å–∞
  - `LLM_PROXY__` –¥–ª—è LLM Proxy —Å–µ—Ä–≤–∏—Å–∞
- –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á OpenAI –≤ `LLM_PROXY__OPENAI_API_KEY`
- –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á Anthropic –≤ `LLM_PROXY__ANTHROPIC_API_KEY`
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–æ—Ä—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã healthcheck)

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ Docker Compose:
```bash
docker compose up -d
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- **gateway** (–ø–æ—Ä—Ç 8000) - WebSocket –ø—Ä–æ–∫—Å–∏ –º–µ–∂–¥—É IDE –∏ Agent
- **agent-runtime** (–ø–æ—Ä—Ç 8001) - –æ—Å–Ω–æ–≤–Ω–∞—è AI –ª–æ–≥–∏–∫–∞
- **llm-proxy** (–ø–æ—Ä—Ç 8002) - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- **litellm-proxy** (–ø–æ—Ä—Ç 4000) - –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö LLM API
- **ollama** (–ø–æ—Ä—Ç 11434) - –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ LLM –º–æ–¥–µ–ª–µ–π

### ü§ñ –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ Ollama

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Ollama –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç [`pull_model_docker.sh`](pull_model_docker.sh):

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, qwen3:0.6b)
./pull_model_docker.sh qwen3:0.6b

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
./pull_model_docker.sh llama3.2:1b
./pull_model_docker.sh mistral:7b
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Ollama
2. –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ `docker compose up -d ollama`
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `ollama pull <–º–æ–¥–µ–ª—å>` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ Ollama:**
- `qwen3:0.6b` - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)
- `llama3.2:1b` - –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –º–æ–¥–µ–ª—å –æ—Ç Meta
- `mistral:7b` - –±–æ–ª–µ–µ –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å
- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫: https://ollama.com/library

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–æ–¥–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volume `ollama-data` –∏ –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

### üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose logs -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f gateway
docker compose logs -f agent-runtime
docker compose logs -f llm-proxy
docker compose logs -f ollama

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes (–≤–∫–ª—é—á–∞—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏)
docker compose down -v

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose restart gateway

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
docker compose up -d --build
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ (health):
```bash
curl http://localhost:8000/health  # gateway
curl http://localhost:8001/health  # agent-runtime
curl http://localhost:8002/health  # llm-proxy
```

## üîå –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ endpoint'–∞–º–∏

### –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ LLM –º–æ–¥–µ–ª–µ–π
curl -X GET http://localhost:8002/v1/llm/models \
  -H "X-Internal-Auth: ${LLM_PROXY__INTERNAL_API_KEY}"

# –ü–æ—Ç–æ–∫–æ–≤–æ–µ –æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ agent-runtime (SSE)
curl -X POST http://localhost:8001/agent/message/stream \
  -H "X-Internal-Auth: ${AGENT_RUNTIME__INTERNAL_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"session_id": "demo", "type": "user_message", "content": "–¢–µ—Å—Ç!"}'

# –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ LLM-proxy (SSE, token-by-token, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å OpenAI)
curl -X POST http://localhost:8002/v1/chat/completions \
  -H "X-Internal-Auth: ${LLM_PROXY__INTERNAL_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"model": "gpt-4", "messages": [{"role": "user", "content": "Say hello!"}], "stream": true, "temperature": 1}'
```

–§–æ—Ä–º–∞—Ç SSE-–æ—Ç–≤–µ—Ç–∞:
```
data: { ... }
data: { ... }
data: [DONE]
```

---

## üîå WebSocket API

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket:
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/{session_id}');

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
ws.send(JSON.stringify({
    type: "user_message",
    content: "Your message here"
}));

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
ws.onmessage = (event) => {
    const response = JSON.parse(event.data);
    console.log(response);
};
```

## üõ† –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ code style

- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ–∏ —é–Ω–∏—Ç- –∏ e2e-—Ç–µ—Å—Ç—ã –≤ –ø–∞–ø–∫–µ `tests/`, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å–ª–æ—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
  ```bash
  cd llm-proxy && uv run pytest tests
  cd ../agent-runtime && uv run pytest tests
  cd ../gateway && uv run pytest tests
  ```
- –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö/—Å–∫–≤–æ–∑–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ `docker compose up -d`.
- –í–µ—Å—å –∫–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–æ–º Ruff, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
  ```bash
  ruff check app/
  ruff check app/ --fix
  ```
- –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `uv`, –∞ dev-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (`ruff`, `ty`) –≤—Ö–æ–¥—è—Ç –≤ `[dev]` —Å–µ–∫—Ü–∏—é pyproject.toml –∫–∞–∂–¥–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.


–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (gateway, agent-runtime, llm-proxy) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –≤–µ—Ä—Å–∏—é Python (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3.12 —á–µ—Ä–µ–∑ pyenv) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å–µ—Ä–≤–∏—Å–∞:**
   ```bash
   cd gateway            # –∏–ª–∏ agent-runtime, –∏–ª–∏ llm-proxy
   ```
2. **–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é Python (—á–µ—Ä–µ–∑ pyenv):**
   ```bash
   pyenv local 3.12.2    # —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω pyenv –∏ python 3.12.2
   ```
3. **–°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Python:**
   ```bash
   python --version      # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å Python 3.12.x
   ```
5. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é uv:**
   ```bash
   uv pip install -e . --upgrade
   ```
6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**
   ```bash
   python app/main.py
   ```

**–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —à–∞–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.**

> üí° –ï—Å–ª–∏ pyenv –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Python —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å pydantic (3.12.x –∏–ª–∏ –Ω–∏–∂–µ)



## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

*–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ—Ä–∂–∞—Ç—å –≤–µ—Ä—Å–∏—é Python –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏!*

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ uv –∏ pyproject.toml –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv pip install -e .

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv pip install -e . --upgrade
```

## üß∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: Ruff –∏ Ty

- **[Ruff](https://docs.astral.sh/ruff/):** –±—ã—Å—Ç—Ä—ã–π python-–ª–∏–Ω—Ç–µ—Ä –∏ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä.
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª—å –∏ –æ—à–∏–±–∫–∏: `ruff check app/`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å: `ruff check app/ --fix`
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî —á–µ—Ä–µ–∑ pyproject.toml; —Ä–∞–±–æ—Ç–∞–µ—Ç ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª —Å VSCode (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Ruff).

- **[Ty](https://docs.astral.sh/ty/):** —É–¥–æ–±–Ω—ã–π CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è requirements.txt ‚Üí pyproject.toml:  
    `ty requirements.txt pyproject.toml`
  - –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ requirements.txt:  
    `ty pyproject.toml > requirements.txt`

**–û–±–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤—Ö–æ–¥—è—Ç –≤ dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞. –î–ª—è –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```bash
uv pip install -e '.[dev]'
```
–∏–ª–∏
```bash
pip install -e '.[dev]'
```

**–í VSCode:**  
- Ruff ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º ‚ÄúRuff‚Äù –∏ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.  
- Ty ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–¥–∞—á–∏ (`.vscode/tasks.json`).

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Ruff](https://docs.astral.sh/ruff/) –∏ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Ty](https://docs.astral.sh/ty/)


---

## üß© –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –∑–∞ —Å—á—ë—Ç —á—ë—Ç–∫–∏—Ö —Å–ª–æ—ë–≤ (api, models, services, middleware, core).
- –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π API –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π router –≤ –ø–∞–ø–∫–µ `api/v2` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–≥–æ –≤ main.py.
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ª–µ–≥–∫–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è: –ø—Ä–æ—Å—Ç–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏, –≤–Ω–µ—à–Ω–∏–µ provider'—ã, —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- –°–º. –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –ø–∞–ø–∫–µ `doc/`, –∞ —Ç–∞–∫–∂–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ README –∫–∞–∂–¥–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VSCode (.vscode/settings.json)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ —Ñ–∞–π–ª `.vscode/settings.json` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```json
{
    // Python settings
    "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
    "python.languageServer": "None",
    
    // Ty settings (–æ—Å–Ω–æ–≤–Ω–æ–π language server)
    "ty.disableLanguageServices": false,
    "ty.diagnosticMode": "workspace",
    "ty.inlayHints.variableTypes": true,
    "ty.inlayHints.callArgumentNames": true,
    "ty.experimental.rename": true,
    "ty.importStrategy": "useBundled",
    
    // Ruff settings (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥)
    "[python]": {
        "editor.defaultFormatter": "charliermarsh.ruff",
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
            "source.fixAll": "explicit"
        }
    },
    
    // Editor settings
    "editor.formatOnSave": true,
    "files.exclude": {
        "**/__pycache__": true,
        "**/.pytest_cache": true,
        "**/.ruff_cache": true
    }
}
```

workspace:

```json
{
	"folders": [
		{
			"path": "."
		},
		{
			"path": "llm-proxy"
		},
		{
			"path": "gateway"
		},
		{
			"path": "agent-runtime"
		}
	],
	"settings": {
		"python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
		"python.languageServer": "None",
		"ty.disableLanguageServices": false,
		"ty.diagnosticMode": "workspace",
		"ty.inlayHints.variableTypes": true,
		"ty.inlayHints.callArgumentNames": true,
		"ty.experimental.rename": true,
		"ty.importStrategy": "useBundled",
		"[python]": {
			"editor.defaultFormatter": "charliermarsh.ruff",
			"editor.formatOnSave": true,
			"editor.codeActionsOnSave": {
				"source.fixAll": "explicit"
			}
		},
		"editor.formatOnSave": true,
		"files.exclude": {
			"**/__pycache__": true,
			"**/.pytest_cache": true,
			"**/.ruff_cache": true
		},
		"python.testing.pytestArgs": [
			"."
		],
		"python.testing.unittestEnabled": false,
		"python.testing.pytestEnabled": true
	}
}
```

> üí° –≠—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç:
> - Ty –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π language server –¥–ª—è Python
> - Ruff –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏–Ω—Ç–∏–Ω–≥–∞
> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
> - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) —Ñ–∞–π–ª –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –≤–∞—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ Pull Request

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `doc/`:
- [–ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](doc/ai-agent-iterative-development-plan.md)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Gateway](doc/tech-req-gateway.md)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Agent Runtime](doc/tech-req-agent-runtime-service.md)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ LLM Proxy](doc/tech-req-llm-proxy-service.md)
