# CodeLab AI Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è AI –∞–≥–µ–Ω—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º.

## üéØ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø:** –§–∞–∑–∞ 1 - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –ò—Ç–µ—Ä–∞—Ü–∏—è 1.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–ó–ê–í–ï–†–®–ï–ù–û)
- üèó –ò—Ç–µ—Ä–∞—Ü–∏—è 1.2: –ë–∞–∑–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–í –ü–†–û–¶–ï–°–°–ï)

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Gateway Service
- WebSocket –ø—Ä–æ–∫—Å–∏ –º–µ–∂–¥—É IDE –∏ Agent
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### Agent Runtime Service
- –û—Å–Ω–æ–≤–Ω–∞—è AI –ª–æ–≥–∏–∫–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### LLM Proxy Service
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI –∏ Anthropic
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –æ—Ç–≤–µ—Ç–æ–≤

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- Docker –∏ Docker Compose
- uv (–±—ã—Å—Ç—Ä—ã–π Python package installer)

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/openidealab/codelab-ai-service.git
cd codelab-ai-service
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ uv:
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example:
```bash
cp .env.example .env
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env —Ñ–∞–π–ª–µ:
- –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à OPENAI_API_KEY
- –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à ANTHROPIC_API_KEY
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
docker compose up -d
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
# Gateway Service
curl http://localhost:8000/health

# Agent Runtime Service
curl http://localhost:8001/health

# LLM Proxy Service
curl http://localhost:8002/health
```

## üîå WebSocket API

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket:
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/{session_id}');

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
ws.send(JSON.stringify({
    type: "user_message",
    content: "Your message here"
}));

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
ws.onmessage = (event) => {
    const response = JSON.parse(event.data);
    console.log(response);
};
```

## üõ† –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (gateway, agent-runtime, llm-proxy) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –≤–µ—Ä—Å–∏—é Python (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3.12 —á–µ—Ä–µ–∑ pyenv) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å–µ—Ä–≤–∏—Å–∞:**
   ```bash
   cd gateway            # –∏–ª–∏ agent-runtime, –∏–ª–∏ llm-proxy
   ```
2. **–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é Python (—á–µ—Ä–µ–∑ pyenv):**
   ```bash
   pyenv local 3.12.2    # —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω pyenv –∏ python 3.12.2
   ```
3. **–°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Python:**
   ```bash
   python --version      # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å Python 3.12.x
   ```
5. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é uv:**
   ```bash
   uv pip install -e . --upgrade
   ```
6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**
   ```bash
   python app/main.py
   ```

**–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —à–∞–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.**

> üí° –ï—Å–ª–∏ pyenv –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Python —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å pydantic (3.12.x –∏–ª–∏ –Ω–∏–∂–µ)



## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ uv –∏ pyproject.toml –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv pip install -e .

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv pip install -e . --upgrade
```

## üß∞ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: Ruff –∏ Ty

- **[Ruff](https://docs.astral.sh/ruff/):** –±—ã—Å—Ç—Ä—ã–π python-–ª–∏–Ω—Ç–µ—Ä –∏ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä.
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª—å –∏ –æ—à–∏–±–∫–∏: `ruff check app/`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å: `ruff check app/ --fix`
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî —á–µ—Ä–µ–∑ pyproject.toml; —Ä–∞–±–æ—Ç–∞–µ—Ç ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª —Å VSCode (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Ruff).

- **[Ty](https://docs.astral.sh/ty/):** —É–¥–æ–±–Ω—ã–π CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è requirements.txt ‚Üí pyproject.toml:  
    `ty requirements.txt pyproject.toml`
  - –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ requirements.txt:  
    `ty pyproject.toml > requirements.txt`

**–û–±–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤—Ö–æ–¥—è—Ç –≤ dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞. –î–ª—è –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```bash
uv pip install -e '.[dev]'
```
–∏–ª–∏
```bash
pip install -e '.[dev]'
```

**–í VSCode:**  
- Ruff ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º ‚ÄúRuff‚Äù –∏ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.  
- Ty ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–¥–∞—á–∏ (`.vscode/tasks.json`).

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Ruff](https://docs.astral.sh/ruff/) –∏ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Ty](https://docs.astral.sh/ty/)

---

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VSCode (.vscode/settings.json)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ —Ñ–∞–π–ª `.vscode/settings.json` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```json
{
    // Python settings
    "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
    "python.languageServer": "None",
    
    // Ty settings (–æ—Å–Ω–æ–≤–Ω–æ–π language server)
    "ty.disableLanguageServices": false,
    "ty.diagnosticMode": "workspace",
    "ty.inlayHints.variableTypes": true,
    "ty.inlayHints.callArgumentNames": true,
    "ty.experimental.rename": true,
    "ty.importStrategy": "useBundled",
    
    // Ruff settings (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥)
    "[python]": {
        "editor.defaultFormatter": "charliermarsh.ruff",
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
            "source.fixAll": "explicit"
        }
    },
    
    // Editor settings
    "editor.formatOnSave": true,
    "files.exclude": {
        "**/__pycache__": true,
        "**/.pytest_cache": true,
        "**/.ruff_cache": true
    }
}
```

> üí° –≠—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç:
> - Ty –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π language server –¥–ª—è Python
> - Ruff –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏–Ω—Ç–∏–Ω–≥–∞
> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
> - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) —Ñ–∞–π–ª –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –≤–∞—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ Pull Request

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `doc/`:
- [–ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](doc/ai-agent-iterative-development-plan.md)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Gateway](doc/tech-req-gateway.md)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Agent Runtime](doc/tech-req-agent-runtime-service.md)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ LLM Proxy](doc/tech-req-llm-proxy-service.md)
