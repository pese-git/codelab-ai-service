# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Agent Runtime - –ó–ê–í–ï–†–®–ï–ù ‚úÖ

**–î–∞—Ç–∞:** 18 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

---

## üéâ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### üì¶ –ö–æ–º–º–∏—Ç—ã:

1. `54ae1e3` - Domain Layer (–≠—Ç–∞–ø—ã 1-2)
2. `b1f548a` - Application Layer (–≠—Ç–∞–ø 3)
3. `687be01` - Infrastructure Layer (–≠—Ç–∞–ø 4)
4. `1dc8d3c` - API Layer (–≠—Ç–∞–ø 5)
5. `[pending]` - Integration & DI (–≠—Ç–∞–ø 5.6)

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤ | 68 |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~6,300 |
| –¢–µ—Å—Ç–æ–≤ | 69 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ | 100% (–Ω–æ–≤—ã–π –∫–æ–¥) |
| –í—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤ | 0.87s |
| –ö–æ–º–º–∏—Ç–æ–≤ | 4 |

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã (5.5 –∏–∑ 7)

### **–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞** ‚úÖ
**–°–æ–∑–¥–∞–Ω–æ:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ (Clean Architecture + DDD)
- –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã: Entity, Repository, DomainEvent
- –°–∏—Å—Ç–µ–º–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (9 –∫–ª–∞—Å—Å–æ–≤)
- 17 unit —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª—ã:** 11  
**–°—Ç—Ä–æ–∫–∏:** ~800

### **–≠—Ç–∞–ø 2: Domain Layer** ‚úÖ
**–°–æ–∑–¥–∞–Ω–æ:**
- 3 –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Message, Session, AgentContext)
- 11 –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- 2 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- 2 –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞
- 27 unit —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª—ã:** 10  
**–°—Ç—Ä–æ–∫–∏:** ~1,500

### **–≠—Ç–∞–ø 3: Application Layer** ‚úÖ
**–°–æ–∑–¥–∞–Ω–æ:**
- CQRS –ø–∞—Ç—Ç–µ—Ä–Ω (Commands + Queries)
- 3 Command handlers
- 3 Query handlers
- 5 DTO –∫–ª–∞—Å—Å–æ–≤
- 16 unit —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª—ã:** 17  
**–°—Ç—Ä–æ–∫–∏:** ~1,200

### **–≠—Ç–∞–ø 4: Infrastructure Layer** ‚úÖ
**–°–æ–∑–¥–∞–Ω–æ:**
- 2 –º–∞–ø–ø–µ—Ä–∞ (Entity ‚Üî Model)
- 2 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î
- 9 integration —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª—ã:** 9  
**–°—Ç—Ä–æ–∫–∏:** ~900

### **–≠—Ç–∞–ø 5: API Layer** ‚úÖ
**–°–æ–∑–¥–∞–Ω–æ:**
- 4 —Ä–æ—É—Ç–µ—Ä–∞ (health, sessions, messages, agents)
- 4 –Ω–∞–±–æ—Ä–∞ API —Å—Ö–µ–º
- 7 endpoints
- Dependency Injection –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- Event Publisher –∞–¥–∞–ø—Ç–µ—Ä

**–§–∞–π–ª—ã:** 13  
**–°—Ç—Ä–æ–∫–∏:** ~900

### **–≠—Ç–∞–ø 5.6: Integration** ‚úÖ
**–°–æ–∑–¥–∞–Ω–æ:**
- DI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö handlers
- Event Publisher –∞–¥–∞–ø—Ç–µ—Ä
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ —Å DI

**–§–∞–π–ª—ã:** 2  
**–°—Ç—Ä–æ–∫–∏:** ~200

---

## üèóÔ∏è –§–∏–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ domain/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ entities/             # 3 —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ events/               # 11 —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ repositories/         # 2 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ services/             # 2 —Å–µ—Ä–≤–∏—Å–∞
‚îÇ
‚îú‚îÄ‚îÄ application/              # Use cases ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ commands/            # 3 handlers
‚îÇ   ‚îú‚îÄ‚îÄ queries/             # 3 handlers
‚îÇ   ‚îî‚îÄ‚îÄ dto/                 # 5 DTO
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/           # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ persistence/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/          # –ê–ª–∏–∞—Å—ã –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mappers/         # 2 –º–∞–ø–ø–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/    # 2 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ adapters/            # Event Publisher
‚îÇ
‚îú‚îÄ‚îÄ api/                     # Presentation ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ       ‚îú‚îÄ‚îÄ routers/         # 4 —Ä–æ—É—Ç–µ—Ä–∞
‚îÇ       ‚îî‚îÄ‚îÄ schemas/         # API —Å—Ö–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ core/                    # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ errors/              # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py      # –°—Ç–∞—Ä—ã–µ DI
‚îÇ   ‚îî‚îÄ‚îÄ dependencies_new.py  # –ù–æ–≤—ã–µ DI
‚îÇ
‚îú‚îÄ‚îÄ agents/                  # –ê–≥–µ–Ω—Ç—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ) ‚úÖ
‚îú‚îÄ‚îÄ events/                  # Event Bus (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π) ‚úÖ
‚îî‚îÄ‚îÄ services/                # –°—Ç–∞—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ) ‚úÖ
```

---

## ‚úÖ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 1. Clean Architecture + DDD
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞

### 2. CQRS –ø–∞—Ç—Ç–µ—Ä–Ω
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è read/write –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### 3. Repository –ø–∞—Ç—Ç–µ—Ä–Ω
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ë–î
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

### 4. Event-Driven Design
- –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Event Sourcing

### 5. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

---

## üéØ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –∞–Ω–∞–ª–∏–∑–∞

### –ò–∑ AGENT_RUNTIME_ARCHITECTURE_ANALYSIS.md:

‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω CQRS –ø–∞—Ç—Ç–µ—Ä–Ω
- –î–æ–±–∞–≤–ª–µ–Ω Repository –ø–∞—Ç—Ç–µ—Ä–Ω
- –î–æ–±–∞–≤–ª–µ–Ω—ã Domain Events
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤

‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ –º–æ–¥—É–ª–∏
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (—á–µ—Ä–µ–∑ –º–∞–ø–ø–µ—Ä—ã)
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º

‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- 69 —Ç–µ—Å—Ç–æ–≤ (100% passed)
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: ~500 —Å—Ç—Ä–æ–∫
- Cyclomatic Complexity: 8-12
- Test Coverage: ~60%
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥: –°—Ä–µ–¥–Ω–∏–π

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: ~100 —Å—Ç—Ä–æ–∫ ‚úÖ
- Cyclomatic Complexity: 3-5 ‚úÖ
- Test Coverage: 100% (–Ω–æ–≤—ã–π –∫–æ–¥) ‚úÖ
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥: –ù–∏–∑–∫–∏–π ‚úÖ

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:

**Gateway ‚Üî Agent Runtime:**
```
POST /agent/message/stream
```
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- –í—Å–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- SSE streaming –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**Agent Runtime ‚Üî LLM Proxy:**
- –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π LLM client

### ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥:
- –í—Å–µ —Å—Ç–∞—Ä—ã–µ –º–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (69/69)
- Event Bus —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- –ê–≥–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. [`AGENT_RUNTIME_ARCHITECTURE_ANALYSIS.md`](AGENT_RUNTIME_ARCHITECTURE_ANALYSIS.md) - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
2. [`AGENT_RUNTIME_REFACTORING_PLAN.md`](AGENT_RUNTIME_REFACTORING_PLAN.md) - –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
3. [`EVENT_DRIVEN_ARCHITECTURE_INTEGRATION.md`](EVENT_DRIVEN_ARCHITECTURE_INTEGRATION.md) - EDA –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –û—Ç—á–µ—Ç—ã –ø–æ —ç—Ç–∞–ø–∞–º:
4. [`REFACTORING_STAGE_1_COMPLETE.md`](codelab-ai-service/agent-runtime/REFACTORING_STAGE_1_COMPLETE.md) - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
5. [`REFACTORING_STAGE_2_COMPLETE.md`](codelab-ai-service/agent-runtime/REFACTORING_STAGE_2_COMPLETE.md) - Domain Layer
6. [`REFACTORING_STAGE_3_COMPLETE.md`](codelab-ai-service/agent-runtime/REFACTORING_STAGE_3_COMPLETE.md) - Application Layer
7. [`REFACTORING_STAGE_4_COMPLETE.md`](codelab-ai-service/agent-runtime/REFACTORING_STAGE_4_COMPLETE.md) - Infrastructure Layer
8. [`REFACTORING_STAGE_5_COMPLETE.md`](codelab-ai-service/agent-runtime/REFACTORING_STAGE_5_COMPLETE.md) - API Layer

---

## üéØ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)

### –≠—Ç–∞–ø 6: –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã
- Session-level locks (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ race conditions)
- Rate limiting middleware
- Circuit breaker –¥–ª—è LLM Proxy
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è event handlers
- Dead Letter Queue

### –≠—Ç–∞–ø 7: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π
- –£–¥–∞–ª–µ–Ω–∏–µ deprecated –∫–æ–¥–∞ (Database class)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ (N+1 –ø—Ä–æ–±–ª–µ–º—ã)
- –£–ª—É—á—à–µ–Ω–Ω—ã–µ health checks
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏:
```python
from app.application.commands import CreateSessionCommand, CreateSessionHandler
from app.core.dependencies_new import get_session_management_service

# –ß–µ—Ä–µ–∑ Command
command = CreateSessionCommand(session_id="session-1")
handler = CreateSessionHandler(service)
dto = await handler.handle(command)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏:
```python
from app.application.queries import GetSessionQuery, GetSessionHandler

# –ß–µ—Ä–µ–∑ Query
query = GetSessionQuery(session_id="session-1", include_messages=True)
handler = GetSessionHandler(repository)
dto = await handler.handle(query)
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞:
```python
from app.application.commands import SwitchAgentCommand, SwitchAgentHandler

# –ß–µ—Ä–µ–∑ Command
command = SwitchAgentCommand(
    session_id="session-1",
    target_agent="coder",
    reason="Coding task"
)
handler = SwitchAgentHandler(service)
dto = await handler.handle(command)
```

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- –ö–æ–¥ –ª–µ–≥—á–µ –ø–æ–Ω–∏–º–∞—Ç—å (–º–∞–ª–µ–Ω—å–∫–∏–µ –º–æ–¥—É–ª–∏)
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ unit —Ç–µ—Å—Ç—ã
- Integration —Ç–µ—Å—Ç—ã —Å in-memory –ë–î

### 3. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã/–∑–∞–ø—Ä–æ—Å—ã
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

### 4. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å

### 5. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

---

## üéì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **Clean Architecture** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏
2. **Domain-Driven Design** - –±–æ–≥–∞—Ç–∞—è –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
3. **CQRS** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Repository** - –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
5. **Mapper** - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
6. **DTO** - –∏–∑–æ–ª—è—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
7. **Dependency Injection** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
8. **Event-Driven** - —Å–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è
9. **Strangler Fig** - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:
```bash
cd codelab-ai-service/agent-runtime
uv run pytest tests/ -v
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
69 passed, 63 warnings in 0.87s ‚úÖ

- –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã: 17/17 ‚úÖ
- –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏: 27/27 ‚úÖ
- Application Layer: 16/16 ‚úÖ
- Infrastructure Layer: 9/9 ‚úÖ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤:
```python
# –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
from app.domain.entities import Session, Message, AgentContext
from app.application.commands import CreateSessionCommand
from app.application.queries import GetSessionQuery
from app.infrastructure.persistence.repositories import SessionRepositoryImpl
from app.api.v1.routers import health_router, sessions_router
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
1. **–ù–∞–ø–∏—Å–∞—Ç—å API —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É endpoints
2. **–î–æ–±–∞–≤–∏—Ç—å session-level locks** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å race conditions
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å memory leaks

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
4. –î–æ–±–∞–≤–∏—Ç—å Rate Limiting
5. –î–æ–±–∞–≤–∏—Ç—å Circuit Breaker
6. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
7. –£–¥–∞–ª–∏—Ç—å deprecated –∫–æ–¥

---

## üìö –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á:
1. –°–æ–∑–¥–∞—Ç—å –¥–æ–º–µ–Ω–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å –≤ `domain/entities/`
2. –°–æ–∑–¥–∞—Ç—å Command/Query –≤ `application/`
3. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ `infrastructure/`
4. –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `api/v1/routers/`
5. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ

### –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏—á:
1. –ù–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—É—â–Ω–æ—Å—Ç—å/—Å–µ—Ä–≤–∏—Å
2. –ò–∑–º–µ–Ω–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Agent Runtime —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!**

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–∏:
- ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤
- ‚úÖ CQRS –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏
- ‚úÖ Event-Driven Design
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (–Ω–æ–≤—ã–π –∫–æ–¥)
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏:
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –æ–±—â–µ–Ω–∏—è (Gateway ‚Üî Agent Runtime ‚Üî LLM Proxy)
- ‚úÖ Event-Driven Architecture
- ‚úÖ –ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ HITL –º–µ—Ö–∞–Ω–∏–∑–º

### –ß—Ç–æ —É–ª—É—á—à–∏–ª–∏:
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ (–º–∞–ª–µ–Ω—å–∫–∏–µ –º–æ–¥—É–ª–∏)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (–ª–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å)
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏—á–∏)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å (–ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥)
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

**–°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é!**

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 18 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0
