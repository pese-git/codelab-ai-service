# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏ 4.1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

## –û–±–∑–æ—Ä
**–¶–µ–ª—å –∏—Ç–µ—Ä–∞—Ü–∏–∏:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–∏—Å—Ç–µ–º—ã.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- LLM Proxy: –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
- Agent Runtime: –ø–∞—Ä—Å–∏–Ω–≥ tool calls –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- Gateway: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É Agent –∏ IDE

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π

**LLM Proxy Service (—Ç–æ–Ω–∫–∏–π —Å–ª–æ–π):**
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (SSE)
- –ü–µ—Ä–µ–¥–∞—á–∞ "—Å—ã—Ä—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –æ—Ç LLM –±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ —á–∞–Ω–∫–æ–≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**Agent Runtime Service (—É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
- –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ tool calls –∏–∑ –ø–æ—Ç–æ–∫–∞ LLM
- –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Gateway –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Å LLM

**Gateway Service (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä):**
- –ü–µ—Ä–µ—Å—ã–ª–∫–∞ tool calls –æ—Ç Agent –∫ IDE
- –ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç IDE –∫ Agent
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞
1. **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ LLM Proxy** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** - –≤—Å—è –ª–æ–≥–∏–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ Agent Runtime
4. **–ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç –∏–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö (–î–µ–Ω—å 1)
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É tool calls –≤–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### 1.1 LLM Proxy models (`llm-proxy/app/models/schemas.py`)
- [ ] –û—Å—Ç–∞–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ - —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `DeltaMessage` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ raw content –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `metadata` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

#### 1.2 Agent Runtime models (`agent-runtime/app/models/schemas.py`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ `ToolCall`, `ToolResult`, `ToolCallRequest`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `ToolCallParser` –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ tool calls –∏–∑ —Ç–µ–∫—Å—Ç–∞
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `SSEToken` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–∏–ø–æ–≤ `tool_call` –∏ `tool_result`
- [ ] –°–æ–∑–¥–∞—Ç—å `SessionState` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö tool calls
- [ ] –î–æ–±–∞–≤–∏—Ç—å `ToolExecutionStatus` enum
- [ ] –°–æ–∑–¥–∞—Ç—å `PendingToolCall` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–∂–∏–¥–∞—é—â–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏

#### 1.3 Gateway models (`gateway/app/models/schemas.py`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `WSToolCall` –∏ `WSToolResult` –¥–ª—è WebSocket
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ tool events
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å `ToolCallTracking` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

---

### –≠—Ç–∞–ø 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è LLM Proxy –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–î–µ–Ω—å 2)
**–¶–µ–ª—å:** LLM Proxy –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏

#### 2.1 –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å OpenAI adapter (`llm-proxy/app/services/llm_adapters/openai.py`)
- [ ] –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å tool calls –≤ raw –≤–∏–¥–µ —á–µ—Ä–µ–∑ metadata
- [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- [ ] –ù–µ –ø–∞—Ä—Å–∏—Ç—å –∏ –Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

#### 2.2 –û–±–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
- [ ] Anthropic adapter - –ø–µ—Ä–µ–¥–∞—á–∞ XML –≤ content –∫–∞–∫ –µ—Å—Ç—å
- [ ] Local LLM adapter - –ø–µ—Ä–µ–¥–∞—á–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### 2.3 –û–±–Ω–æ–≤–∏—Ç—å streaming –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é
- [ ] –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞–Ω–∫–µ
- [ ] –í–∫–ª—é—á–∞—Ç—å metadata –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** LLM Proxy –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

---

### –≠—Ç–∞–ø 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ tool calls –≤ Agent Runtime (–î–µ–Ω—å 3-4)
**–¶–µ–ª—å:** Agent Runtime —É–º–µ–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å tool calls

#### 3.1 –°–æ–∑–¥–∞—Ç—å Tool Call Parser (`agent-runtime/app/services/tool_parser.py`)
- [ ] –ü–∞—Ä—Å–µ—Ä –¥–ª—è OpenAI native tool calls
- [ ] –ü–∞—Ä—Å–µ—Ä –¥–ª—è XML —Ñ–æ—Ä–º–∞—Ç–∞ (Anthropic/Claude)
- [ ] –ü–∞—Ä—Å–µ—Ä –¥–ª—è custom —Ñ–æ—Ä–º–∞—Ç–æ–≤ (–ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏)
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã tool calls
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

#### 3.2 –°–æ–∑–¥–∞—Ç—å Tool Manager (`agent-runtime/app/services/tool_manager.py`)
- [ ] –ö–ª–∞—Å—Å `ToolCallTracker` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [ ] –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è tool calls –∏ results –ø–æ ID
- [ ] –û—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞—é—â–∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] –ú–µ—Ö–∞–Ω–∏–∑–º retry –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### 3.3 –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å LLM Stream Service (`agent-runtime/app/services/llm_stream_service.py`)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tool Parser –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è tool calls
- [ ] –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ tool call
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ tool_call –≤ Gateway —á–µ—Ä–µ–∑ HTTP
- [ ] –û–∂–∏–¥–∞–Ω–∏–µ tool_result —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- [ ] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –¥–ª—è LLM
- [ ] –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Å LLM
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö tool calls

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** Agent Runtime –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

---

### –≠—Ç–∞–ø 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ tool calls –≤ Agent Runtime (–î–µ–Ω—å 5-6)
**–¶–µ–ª—å:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### 4.1 –°–æ–∑–¥–∞—Ç—å Tool Call endpoints (`agent-runtime/app/api/v1/endpoints.py`)
- [ ] POST `/agent/tool/result` –¥–ª—è –ø—Ä–∏–µ–º–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç Gateway
- [ ] GET `/agent/tool/pending` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–∂–∏–¥–∞—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤
- [ ] DELETE `/agent/tool/cancel/{tool_call_id}` –¥–ª—è –æ—Ç–º–µ–Ω—ã
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è tool_result —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- [ ] –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å –æ–∂–∏–¥–∞—é—â–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏

#### 4.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º
- [ ] –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è message handler –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ tool flow
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–µ–ø–æ—á–µ–∫ tool calls
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

#### 4.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ edge cases
- [ ] –¢–∞–π–º–∞—É—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Gateway
- [ ] –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç IDE
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** Agent Runtime –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

---

### –≠—Ç–∞–ø 5: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gateway (–î–µ–Ω—å 7-8)
**–¶–µ–ª—å:** Gateway –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç tool calls –º–µ–∂–¥—É Agent –∏ IDE

#### 5.1 –†–∞—Å—à–∏—Ä–∏—Ç—å WebSocket handler (`gateway/app/api/v1/endpoints.py`)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ tool_call —Å–æ–±—ã—Ç–∏–π –æ—Ç Agent –≤ SSE –ø–æ—Ç–æ–∫–µ
- [ ] –ü–µ—Ä–µ—Å—ã–ª–∫–∞ tool_call –≤ IDE —á–µ—Ä–µ–∑ WebSocket
- [ ] –ü—Ä–∏–µ–º tool_result –æ—Ç IDE —á–µ—Ä–µ–∑ WebSocket
- [ ] HTTP –∑–∞–ø—Ä–æ—Å –∫ Agent –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ disconnect –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è tool
- [ ] –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

#### 5.2 –°–æ–∑–¥–∞—Ç—å Tool Router (`gateway/app/services/tool_router.py`)
- [ ] –ö–ª–∞—Å—Å `ToolCallRouter` –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ session_id
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ pending tool calls –≤ –ø–∞–º—è—Ç–∏
- [ ] –ú–µ—Ö–∞–Ω–∏–∑–º timeout —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ–Ω–æ–π
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö tool results
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### 5.3 –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å Stream Service (`gateway/app/services/stream_service.py`)
- [ ] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ tool_call —Å–æ–±—ã—Ç–∏–π –≤ SSE –ø–æ—Ç–æ–∫–µ
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –ø–æ—Ç–æ–∫–∞
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –ø–æ—Å–ª–µ tool execution
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö tool results

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** –ü–æ–ª–Ω—ã–π pipeline –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–î–µ–Ω—å 9)
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### 6.1 –°–æ–∑–¥–∞—Ç—å unit —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç—ã Tool Parser –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- [ ] –¢–µ—Å—Ç—ã Tool Manager (timeouts, correlations)
- [ ] –¢–µ—Å—Ç—ã Tool Router (routing, buffering)
- [ ] –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö

#### 6.2 –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- [ ] –¢–µ—Å—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- [ ] –¢–µ—Å—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- [ ] –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

#### 6.3 –°–æ–∑–¥–∞—Ç—å mock IDE client (`tests/mock_ide_client.py`)
- [ ] –≠–º—É–ª—è—Ü–∏—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tool calls
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### 6.4 End-to-end —Ç–µ—Å—Ç—ã
- [ ] –ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º LLM
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [ ] Performance —Ç–µ—Å—Ç—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

---

### –≠—Ç–∞–ø 7: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–î–µ–Ω—å 10)
**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

#### 7.1 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è tool calls/results
- [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### 7.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] Connection pooling
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
- [ ] –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 7.3 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
- [ ] Health checks
- [ ] Graceful shutdown
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞:** Production-ready —Å–∏—Å—Ç–µ–º–∞

---

## –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ Tool calls –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è Agent Runtime
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤—Å–µ —Å–ª–æ–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ tool calls
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚è±Ô∏è Latency –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è tool call < 50ms
- ‚è±Ô∏è –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª tool execution < 5s (–±–µ–∑ —É—á–µ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ IDE)
- üìä Success rate > 99.9% –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

### –ö–∞—á–µ—Å—Ç–≤–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- üèóÔ∏è –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
- üß© –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
- üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- üìù –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –ü—Ä–∏–º–µ—Ä—ã –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è tool call

```
1. LLM Provider ‚Üí LLM Proxy: 
   {"content": "I'll read the file\n<read_file>...", "tool_calls": [...]}

2. LLM Proxy ‚Üí Agent Runtime (SSE):
   data: {"token": "I'll read the file\n<read_file>...", "metadata": {...}}

3. Agent Runtime (–ø–∞—Ä—Å–∏–Ω–≥):
   - –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç tool call –≤ content –∏–ª–∏ metadata
   - –°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ToolCall –æ–±—ä–µ–∫—Ç
   - –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫

4. Agent Runtime ‚Üí Gateway:
   POST /gateway/tool/execute
   {"session_id": "...", "tool_call": {...}}

5. Gateway ‚Üí IDE (WebSocket):
   {"type": "tool_call", "call_id": "...", "tool": "read_file", ...}
```

### –ü–æ—Ç–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```
1. IDE ‚Üí Gateway (WebSocket):
   {"type": "tool_result", "call_id": "...", "result": {...}}

2. Gateway ‚Üí Agent Runtime:
   POST /agent/tool/result
   {"session_id": "...", "call_id": "...", "result": {...}}

3. Agent Runtime:
   - –ù–∞—Ö–æ–¥–∏—Ç –æ–∂–∏–¥–∞—é—â–∏–π tool call
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è LLM —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
   - –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∏–∞–ª–æ–≥

4. Agent Runtime ‚Üí LLM Proxy:
   POST /llm/chat
   {"messages": [..., {"role": "tool", "content": "..."}]}
```

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
1. **–†–∏—Å–∫:** –†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã tool calls —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤ –≤ Agent Runtime

2. **–†–∏—Å–∫:** –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏

3. **–†–∏—Å–∫:** Race conditions –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö tool calls
   - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ LLM Proxy** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏** - –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
3. **–ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç —á–µ—Ç–∫—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
